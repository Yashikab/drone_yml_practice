kind: pipeline
type: docker
name: default

steps:
- name: greeting
  image: python:3.7
  environment:
    REVIEWDOG_GITHUB_API_TOKEN:
      from_secret: reviewdog
  commands:
    - echo "install reviewdog"
    - go get -u github.com/reviewdog/reviewdog/cmd/reviewdog
    - pip install pipenv==2018.11.26
    - pipenv install --dev --system
    - pip freeze
    - reviewdog -conf=./.reviewdog.yml -reporter=github-pr-review
  when:
    event:
      - pull_request

- name: merge
  image: python:3.7
  commands:
    - pip install pipenv
    - pipenv install --system
    - python main2.py
  when:
    branch:
      - master
    event:
      - push
